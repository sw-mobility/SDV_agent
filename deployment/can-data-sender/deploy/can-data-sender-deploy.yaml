apiVersion: apps/v1
kind: Deployment
metadata:
  name: can-data-sender-deploy
  namespace: sdv # ğŸ’¡ ë„¤ì„ìŠ¤í˜ì´ìŠ¤: sdv
  labels:
    app: can-data-sender
spec:
  replicas: 1 
  selector:
    matchLabels:
      app: can-data-sender
  template:
    metadata:
      labels:
        app: can-data-sender
    spec:
      # HostPath ì‚¬ìš© ì‹œ íŠ¹ì • ë…¸ë“œì— ê³ ì •í•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
      nodeSelector:
        kubernetes.io/hostname: "etri-jetson" 
        hardware: "gpu" 
        
      containers:
      - name: can-data-sender-container
        image: registry.suredatalab.kr/etri/sdv/can-data-sender:v1 
        imagePullPolicy: Always
        
        command: ["python"]
        args: ["send_ev_data.py"]
        env:
        # 1. ì„œë²„ ì•± ì ‘ì† ì •ë³´ (sdv ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ Service ì´ë¦„)
        - name: SERVER_BASE_URL
          value: "http://192.168.8.131:30888" 
        - name: SERVER_END_POINT
          value: "/api/vehicle/realtime" 
        # 2. ë°ì´í„° ë””ë ‰í† ë¦¬ ì„¤ì • (ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ë§ˆìš´íŠ¸ ê²½ë¡œ)
        - name: DATA_ROOT_DIR
          value: "/mnt/data/daily" # ì—£ì§€ ì•± ì½”ë“œì—ì„œ ë°ì´í„°ë¥¼ ì½ì„ ê²½ë¡œ
        - name: TRANSMISSION_INTERVAL
          value: "10"

        volumeMounts:
        - name: daily-data-hostpath
          mountPath: /mnt/data/daily # ğŸ’¡ DATA_ROOT_DIRê³¼ ì¼ì¹˜
      imagePullSecrets:
      - name: gitlab-registry-secret

      # HostPath Volume ì •ì˜
      volumes:
      - name: daily-data-hostpath
        hostPath:
          path: /home/etri/data/daily
          type: DirectoryOrCreate
